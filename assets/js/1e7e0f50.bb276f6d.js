"use strict";(self.webpackChunkten_docs=self.webpackChunkten_docs||[]).push([[664],{4159:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>l,frontMatter:()=>i,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"write-ten-dapp/session-keys","title":"Account Abstraction","description":"The key feature of Account Abstraction (EIP-4337) is \u201csession keys\u201d (SKs) through a proxy smart contract.","source":"@site/docs/4-write-ten-dapp/4-session-keys.md","sourceDirName":"4-write-ten-dapp","slug":"/write-ten-dapp/session-keys","permalink":"/docs/write-ten-dapp/session-keys","draft":false,"unlisted":false,"editUrl":"https://github.com/ten-protocol/ten-documentation/blob/main/docs/4-write-ten-dapp/4-session-keys.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Network Configuration","permalink":"/docs/write-ten-dapp/network-setup"},"next":{"title":"Cross-Chain Bridging","permalink":"/docs/write-ten-dapp/bridging"}}');var a=s(4848),o=s(8453);const i={sidebar_position:4},r="Account Abstraction",d={},h=[{value:"Solution overview",id:"solution-overview",level:2},{value:"Usage",id:"usage",level:2},{value:"When the game starts",id:"when-the-game-starts",level:3},{value:"During the game",id:"during-the-game",level:3},{value:"Managing session keys",id:"managing-session-keys",level:3},{value:"Finishing the game",id:"finishing-the-game",level:3},{value:"Example implementation",id:"example-implementation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"account-abstraction",children:"Account Abstraction"})}),"\n",(0,a.jsxs)(n.p,{children:["The key feature of ",(0,a.jsx)(n.a,{href:"https://medium.com/p/2e85bde4c54d",children:"Account Abstraction"})," (EIP-4337) is \u201csession keys\u201d (SKs) through a proxy smart contract.\nSKs allow users to interact with the blockchain without signing every transaction, which is a major UX improvement."]}),"\n",(0,a.jsx)(n.p,{children:'TEN supports "native" SKs - these are managed by the platform and do not require a proxy contract.'}),"\n",(0,a.jsx)(n.p,{children:"In TEN, SKs are managed by dApp developers through dedicated RPC endpoints."}),"\n",(0,a.jsx)(n.h2,{id:"solution-overview",children:"Solution overview"}),"\n",(0,a.jsx)(n.p,{children:"Imagine you're developing an on-chain game, and you want a smooth UX without the distraction of signing every move."}),"\n",(0,a.jsx)(n.p,{children:"Conceptually, the game will create a session key (SK) for the user, then ask the user to move some funds to that address, and then create \u201cmove\u201d transactions signed with the SK."}),"\n",(0,a.jsx)(n.p,{children:"If the game were to create the SK in the browser, there would be a risk of the user losing the SK, and the funds associated with it, in case of an accidental exit.\nWith TEN, the dApp developer doesn't have to worry about this, because the SKs are managed by TEEs."}),"\n",(0,a.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,a.jsx)(n.p,{children:"The steps below describe the implementation for a game developer\u2014the primary use case for SKs.\nNote that SKs can be used for any dApp that requires a no\u2011click UX."}),"\n",(0,a.jsx)(n.h3,{id:"when-the-game-starts",children:"When the game starts"}),"\n",(0,a.jsx)(n.p,{children:"Before the user can start playing, the game must create the SK and ask the user to move some funds to that address.\nThe funds will be used to pay for moves."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Call the RPC ",(0,a.jsx)(n.code,{children:"eth_getStorageAt"})," with address ",(0,a.jsx)(n.code,{children:"0x0000000000000000000000000000000000000003"})," - this will return the hex-encoded address of the SK. The dApp needs to store this address for future use."]}),"\n",(0,a.jsx)(n.li,{children:'Create a normal transaction that transfers some ETH to the SK. The amount depends on how many "moves" the user is prepared to prepay for.'}),"\n",(0,a.jsx)(n.li,{children:"Ask the user to sign this transaction with their standard wallet, and submit it to the network using the library of your choice."}),"\n",(0,a.jsx)(n.li,{children:"The session key is automatically activated and ready to use."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"during-the-game",children:"During the game"}),"\n",(0,a.jsxs)(n.p,{children:["After sending funds to the SK, create a transaction for each move, but don't ask the user to sign them.\nInstead, submit them to the network unsigned using the RPC ",(0,a.jsx)(n.code,{children:"eth_getStorageAt"})," with address ",(0,a.jsx)(n.code,{children:"0x0000000000000000000000000000000000000005"})," and the following parameters:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "sessionKeyAddress": "0x...", // The session key address\n  "tx": "base64_encoded_transaction" // The unsigned transaction encoded as base64\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"The platform will sign the transactions on behalf of the user."}),"\n",(0,a.jsx)(n.p,{children:"As a game developer, you are responsible for keeping track of the SK\u2019s balance. You can also query the network for the balance of the SK address.\nIf the SK runs out of balance, you must ask the user to move more funds to the SK."}),"\n",(0,a.jsx)(n.h3,{id:"managing-session-keys",children:"Managing session keys"}),"\n",(0,a.jsx)(n.p,{children:"TEN provides additional RPC endpoints for managing session keys:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"eth_getStorageAt"})," with address ",(0,a.jsx)(n.code,{children:"0x0000000000000000000000000000000000000004"})," \u2014 permanently removes the session key. This requires the following parameters:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "sessionKeyAddress": "0x..." // The session key address to delete\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"finishing-the-game",children:"Finishing the game"}),"\n",(0,a.jsx)(n.p,{children:"When a game ends, you must move the remaining funds back to the main address."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Create a transaction (tx) that moves the funds back from the SK to the main address. Submit it unsigned, because the funds are controlled by the SK."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"example-implementation",children:"Example implementation"}),"\n",(0,a.jsx)(n.p,{children:"Here's a complete example of how to implement session keys in a JavaScript dApp:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'// 1. Create a session key\nasync function createSessionKey() {\n  const response = await fetch("https://testnet.ten.xyz/v1/", {\n    method: "POST",\n    headers: { "Content-Type": "application/json" },\n    body: JSON.stringify({\n      jsonrpc: "2.0",\n      method: "eth_getStorageAt",\n      params: ["0x0000000000000000000000000000000000000003", "0x0", "latest"],\n      id: 1,\n    }),\n  });\n\n  const data = await response.json();\n  return data.result; // Returns the session key address\n}\n\n// 2. Fund the session key (user signs this transaction)\nasync function fundSessionKey(sessionKeyAddress, amount) {\n  // This would be a normal transaction signed by the user\'s wallet\n  // transferring ETH to the session key address\n}\n\n// 3. Send unsigned transactions using the session key\nasync function sendUnsignedTransaction(sessionKeyAddress, unsignedTx) {\n  const txBase64 = btoa(JSON.stringify(unsignedTx)); // Convert to base64\n\n  const response = await fetch("https://testnet.ten.xyz/v1/", {\n    method: "POST",\n    headers: { "Content-Type": "application/json" },\n    body: JSON.stringify({\n      jsonrpc: "2.0",\n      method: "eth_getStorageAt",\n      params: [\n        "0x0000000000000000000000000000000000000005",\n        JSON.stringify({\n          sessionKeyAddress: sessionKeyAddress,\n          tx: txBase64,\n        }),\n        "latest",\n      ],\n      id: 1,\n    }),\n  });\n\n  const data = await response.json();\n  return data.result; // Returns the transaction hash\n}\n\n// 4. Delete the session key when done\nasync function deleteSessionKey(sessionKeyAddress) {\n  const response = await fetch("https://testnet.ten.xyz/v1/", {\n    method: "POST",\n    headers: { "Content-Type": "application/json" },\n    body: JSON.stringify({\n      jsonrpc: "2.0",\n      method: "eth_getStorageAt",\n      params: [\n        "0x0000000000000000000000000000000000000004",\n        JSON.stringify({\n          sessionKeyAddress: sessionKeyAddress,\n        }),\n        "latest",\n      ],\n      id: 1,\n    }),\n  });\n\n  const data = await response.json();\n  return data.result; // Returns 0x01 for success, 0x00 for failure\n}\n'})})]})}function l(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>r});var t=s(6540);const a={},o=t.createContext(a);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);