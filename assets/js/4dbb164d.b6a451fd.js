"use strict";(self.webpackChunkten_docs=self.webpackChunkten_docs||[]).push([[26],{8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(6540);const r={},a=s.createContext(r);function i(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:n},e.children)}},9241:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"write-ten-dapp/programmable-gateway-access","title":"Programmable Access to Gateway","description":"TEN Network Gateway API (testnet)","source":"@site/docs/4-write-ten-dapp/9-programmable-gateway-access.md","sourceDirName":"4-write-ten-dapp","slug":"/write-ten-dapp/programmable-gateway-access","permalink":"/docs/write-ten-dapp/programmable-gateway-access","draft":false,"unlisted":false,"editUrl":"https://github.com/ten-protocol/ten-documentation/blob/main/docs/4-write-ten-dapp/9-programmable-gateway-access.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"Tutorial","permalink":"/docs/write-ten-dapp/tutorial"},"next":{"title":"Run a TEN node","permalink":"/docs/category/run-a-ten-node"}}');var r=t(4848),a=t(8453);const i={sidebar_position:9},o="Programmable Access to Gateway",c={},d=[{value:"TEN Network Gateway API (testnet)",id:"ten-network-gateway-api-testnet",level:2},{value:"High\u2011level flow",id:"highlevel-flow",level:3},{value:"1. Get Encryption Token",id:"1-get-encryption-token",level:2},{value:"2. Get Message to Sign",id:"2-get-message-to-sign",level:2},{value:"3. Authenticate User",id:"3-authenticate-user",level:2},{value:"4. Query Address Registration",id:"4-query-address-registration",level:2},{value:"5. Revoke Access",id:"5-revoke-access",level:2},{value:"6. JSON\u2011RPC Usage",id:"6-jsonrpc-usage",level:2},{value:"7. Health &amp; Network Endpoints",id:"7-health--network-endpoints",level:2},{value:"8. Token Cookie Helper Endpoints (Browser flows)",id:"8-token-cookie-helper-endpoints-browser-flows",level:2},{value:"9. Using the TEN Hardhat plugin",id:"9-using-the-ten-hardhat-plugin",level:2}];function l(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"programmable-access-to-gateway",children:"Programmable Access to Gateway"})}),"\n",(0,r.jsx)(n.h2,{id:"ten-network-gateway-api-testnet",children:"TEN Network Gateway API (testnet)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Base URL (testnet gateway):"})," ",(0,r.jsx)(n.code,{children:"https://testnet-rpc.ten.xyz"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Testnet frontend (UI):"})," ",(0,r.jsx)(n.a,{href:"https://testnet.ten.xyz",children:(0,r.jsx)(n.code,{children:"https://testnet.ten.xyz"})})," \u2013 hosted gateway UI that talks to the same testnet gateway."]}),"\n",(0,r.jsxs)(n.p,{children:["All HTTP endpoints below are served under the gateway base URL and versioned under ",(0,r.jsx)(n.code,{children:"/v1"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"highlevel-flow",children:"High\u2011level flow"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"1. Create a user & encryption token"})," via ",(0,r.jsx)(n.code,{children:"/v1/join/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"2. Get a message to sign"})," via ",(0,r.jsx)(n.code,{children:"/v1/getmessage/"})," using that token."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"3. Authenticate"})," by sending the signed message to ",(0,r.jsx)(n.code,{children:"/v1/authenticate/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"4. (Optional) Query registration state"})," for specific addresses via ",(0,r.jsx)(n.code,{children:"/v1/query/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"5. (Optional) Revoke"})," the token via ",(0,r.jsx)(n.code,{children:"/v1/revoke/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"6. Call JSON\u2011RPC"})," using the token as a query parameter."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"1-get-encryption-token",children:"1. Get Encryption Token"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Endpoint:"})," ",(0,r.jsx)(n.code,{children:"POST /v1/join/"})]}),"\n",(0,r.jsxs)(n.p,{children:["Creates a new gateway user, generates a fresh viewing key pair, and returns the corresponding ",(0,r.jsx)(n.strong,{children:"encryption token"})," (also called \u201cgateway token\u201d) as a hex string. This is used with HTTP and JSON-RPC endpoints"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -X POST https://testnet-rpc.ten.xyz/v1/join/\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'const response = await fetch("https://testnet-rpc.ten.xyz/v1/join/", {\n  method: "POST",\n});\nconst encryptionToken = await response.text(); // hex string\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"2-get-message-to-sign",children:"2. Get Message to Sign"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Endpoint:"})," ",(0,r.jsx)(n.code,{children:"POST /v1/getmessage/"})]}),"\n",(0,r.jsxs)(n.p,{children:["Generates and returns an authentication message for the user to sign based on the provided encryption token. The gateway can return either an EIP\u2011712 typed message (default) or a ",(0,r.jsx)(n.code,{children:"personal_sign"})," message in case of compatibility with older wallets."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request body:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "encryptionToken": "<hex user token>",\n  "formats": ["EIP712", "personal_sign"] // optional; order is preference\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example (cURL):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://testnet-rpc.ten.xyz/v1/getmessage/" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "encryptionToken": "<EncryptionToken>",\n    "formats": ["EIP712"]\n  }\'\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example (JavaScript):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'const msgRes = await fetch("https://testnet-rpc.ten.xyz/v1/getmessage/", {\n  method: "POST",\n  headers: { "Content-Type": "application/json" },\n  body: JSON.stringify({\n    encryptionToken,\n    formats: ["EIP712"],\n  }),\n});\n\nconst { message, type } = await msgRes.json(); // type: "EIP712" | "personal_sign"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["You then pass ",(0,r.jsx)(n.code,{children:"message"})," to the user\u2019s wallet to be signed."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"3-authenticate-user",children:"3. Authenticate User"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Endpoint:"})," ",(0,r.jsx)(n.code,{children:"POST /v1/authenticate/?token=<EncryptionToken>"})]}),"\n",(0,r.jsxs)(n.p,{children:["Submits the signed message and proves wallet ownership. The gateway verifies the signature and binds the wallet address to the user identified by ",(0,r.jsx)(n.code,{children:"token"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request body:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "address": "0x...",\n  "signature": "0x...",\n  "type": "EIP712" // optional, defaults to EIP712\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example (cURL):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://testnet-rpc.ten.xyz/v1/authenticate/?token=<EncryptionToken>" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "address": "0xYourAddress",\n    "signature": "0xYourSignature",\n    "type": "EIP712"\n  }\'\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example (JavaScript):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'await fetch(\n  `https://testnet-rpc.ten.xyz/v1/authenticate/?token=${encryptionToken}`,\n  {\n    method: "POST",\n    headers: { "Content-Type": "application/json" },\n    body: JSON.stringify({\n      address,\n      signature: sig,\n      type: "EIP712",\n    }),\n  },\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:"Multiple addresses can be associated with a single encryption token."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"4-query-address-registration",children:"4. Query Address Registration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Endpoint:"})," ",(0,r.jsx)(n.code,{children:"GET /v1/query/?token=<EncryptionToken>&a=<Address>"})]}),"\n",(0,r.jsx)(n.p,{children:"Returns whether a given address is already registered (bound) for the user."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example (cURL):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl "https://testnet-rpc.ten.xyz/v1/query/?token=<EncryptionToken>&a=0xYourAddress"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Response:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": true\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example (JavaScript):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const res = await fetch(\n  `https://testnet-rpc.ten.xyz/v1/query/?token=${encryptionToken}&a=${address}`,\n);\nconst data = await res.json(); // { status: boolean }\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"5-revoke-access",children:"5. Revoke Access"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Endpoint:"})," ",(0,r.jsx)(n.code,{children:"POST /v1/revoke/?token=<EncryptionToken>"})]}),"\n",(0,r.jsxs)(n.p,{children:["Deletes the user identified by ",(0,r.jsx)(n.code,{children:"token"})," along with associated viewing keys and session keys in the gateway."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://testnet-rpc.ten.xyz/v1/revoke/?token=<EncryptionToken>"\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'await fetch(`https://testnet-rpc.ten.xyz/v1/revoke/?token=${encryptionToken}`, {\n  method: "POST",\n});\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"6-jsonrpc-usage",children:"6. JSON\u2011RPC Usage"}),"\n",(0,r.jsx)(n.p,{children:"After authenticating at least one address for a user, you can send Ethereum\u2011style JSON\u2011RPC requests through the gateway by including the encryption token as a query parameter."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"RPC endpoint (HTTP):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"https://testnet-rpc.ten.xyz/v1/?token=<EncryptionToken>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example payload:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://testnet-rpc.ten.xyz/v1/?token=<EncryptionToken>" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "id": 1,\n    "method": "eth_getBalance",\n    "params": ["0xYourAddress", "latest"]\n  }\'\n'})}),"\n",(0,r.jsx)(n.p,{children:"The gateway enforces that reads and writes are scoped to accounts that are bound to the encryption token and forwards calls to the TEN node over an encrypted channel."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"7-health--network-endpoints",children:"7. Health & Network Endpoints"}),"\n",(0,r.jsx)(n.p,{children:"These endpoints are useful for monitoring and discovering network configuration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"GET /v1/ready/"})})," \u2013 lightweight readiness probe indicating the gateway process is up."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"GET /v1/health/"})})," \u2013 basic health check of the gateway itself (cached briefly)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"GET /v1/network-health/"})})," \u2013 TEN node health wrapped in a JSON\u2011RPC\u2011like response."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"GET /v1/network-config/"})})," \u2013 static network configuration (contract addresses, registries, etc.)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"GET /v1/version/"})})," \u2013 current gateway version as a plain string."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["All are exposed under ",(0,r.jsx)(n.code,{children:"https://testnet-rpc.ten.xyz/v1/..."}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"8-token-cookie-helper-endpoints-browser-flows",children:"8. Token Cookie Helper Endpoints (Browser flows)"}),"\n",(0,r.jsxs)(n.p,{children:["When integrating with a browser frontend, the gateway can store the encryption token in a secure cookie (domain\u2011wide on ",(0,r.jsx)(n.code,{children:".ten.xyz"}),"):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"GET /v1/get-token/"})})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reads the gateway token cookie, validates it, ensures the user exists, and returns the token as a hex string."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"POST /v1/set-token/"})})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Request body: ",(0,r.jsx)(n.code,{children:'{ "token": "<hex user token>" }'})]}),"\n",(0,r.jsxs)(n.li,{children:["Validates the token, checks that the user exists, and sets a long\u2011lived ",(0,r.jsx)(n.code,{children:"HttpOnly"}),", ",(0,r.jsx)(n.code,{children:"Secure"})," cookie for use by browser dApps."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Both endpoints are also served under ",(0,r.jsx)(n.code,{children:"https://testnet-rpc.ten.xyz/v1/..."})," and are guarded by CORS based on the configured frontend URL."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"9-using-the-ten-hardhat-plugin",children:"9. Using the TEN Hardhat plugin"}),"\n",(0,r.jsxs)(n.p,{children:["For Hardhat\u2011based development, you can also integrate with the TEN testnet gateway using the ",(0,r.jsx)(n.strong,{children:"TEN Hardhat plugin"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Package:"})," ",(0,r.jsx)(n.code,{children:"@tenprotocol/ten-hardhat-plugin"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Docs & usage:"})," see the plugin README on npm:",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/@tenprotocol/ten-hardhat-plugin",children:(0,r.jsx)(n.code,{children:"https://www.npmjs.com/package/@tenprotocol/ten-hardhat-plugin"})})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The plugin configures a Hardhat network to talk to the same JSON\u2011RPC gateway at ",(0,r.jsx)(n.code,{children:"https://testnet-rpc.ten.xyz"})," and is the recommended way to interact with TEN from Hardhat projects."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);